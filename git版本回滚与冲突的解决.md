## git版本回滚与冲突的解决

### 版本回滚

> git主要分为工作区、暂存区，本地仓库与远程仓库

* **工作区回滚**

  主要使用`git checkout -- [文件名]`或`git checkout --`,两者针对不同层面对文件版本进行回滚，无论是增添的内容还是删除的内容，都可以还原至上一个状态。

* **暂存区回滚**

  将工作区的文件上传至暂存区时，我们主要使用`git add`命令。此时若需要版本回滚，可以使用`git reset --keep`来回滚暂存区全部文件。使用此命令相当于撤销`git add`操作。

  也可以使用更细致的命令。`git reset HEAD file`可以回滚单个文件，`git reset HEAD .`可以回滚全部文件。此操作相当于撤销`git add`操作，并将工作区内容还原至上个版本内容。

* **本地仓库回滚**
  1. 回滚到暂存区（相当于撤销`git commit`操作）：`git reset --soft 版本号`。
  2. 回滚到工作区（相当于撤销`git commit`及`git add`操作）：`git reset --mixed 版本号`。
  3. 回滚到工作区（相当于撤销`git commit`及`git add`操作）并且丢弃修改内容：`git reset --hard 版本号`。

​       **注意点:**

1. `git reflog`可以查看每一次命令，包括版本号，使用版本号和上述命令便可以穿越时空！

2. `git reset --hard HEAD^`回滚至上一次提交，工作区内容同步回滚。

   `git reset HEAD^`回滚至上一次提交，工作区内容不会被修改。可使用`git restore 文件`还原到工作区。

* **远程仓库回滚**

  文件一旦提交到远程仓库，据我所知是没有办法直接回滚的。只能使用暴力方法。即先在本地回滚，再利用`git push -f origin 分支`命令强制覆盖推送。这种方法应该我认为只能算作“伪回滚”。

  **注意点：**

  1. 本地分支回滚后，版本将落后远程分支，必须使用强制推送覆盖远程分支，否则无法推送到远程分支。

  2. GitHub所有分支默认是关闭强制推送功能的，如需进行强制推送，需开启对应功能。

* `git revert`:剑走偏锋，通过以回滚版本创造一个新PLUS版本并覆盖新版本来达到回滚的目的，我的评价是小杯，“伪回滚”。



### git冲突的解决

#### git分支管理

* **原理剖析**

​       通过学习廖老师的教程，我对分支有了一个更宏观的认识。对前面一直出现的`HEAD`指针，老师也做了一个清晰的解释。实际上，`HEAD`是指向当前分支的。而所谓的合并，实际上只是改变指针的位置，文件的位置实际上并无改变。感觉有点像链表？

* **基本命令**

  1. `git checkout 分支`:切换至该分支。若加上参数`-b`，则会创建并切换至该分支。（相当于先`git branch 分支`）

     也可以使用`git switch`命令。

  2. `git branch`：查看当前分支。

  3. `git merge 分支`：将该分支合并到当前分支（HEAD）

  4. `git branch -d 分支`：删除分支

     **实操**

     使用上述命令，我将之前创建在master分支下的`hello.md`文件合并到了main分支下，即将master合并到main。

     **遇到的问题**

     ​        **git pull 提示错误 fatal：refusing to merge unrelated histories**

     ​        造成问题的原因：我在同一个文件夹目录下手动添加了一个github上的同名文件，可能造成了远程与本地的不兼容。  

     ​        解决方法：将远程仓库的文件clone到本地，并删除那个文件夹。在`git pull`与`git push`的命令中添加` --allow-unrelated-histories`,从而允许提交不关联的历史代码。

#### git冲突的解决

* **产生原因**

  根据教程，我理解的原因是在同一个主干道上创建分支后，更新操作在不同的分支上存在，造成历史版本的不一致，从而产生冲突。换言之，同一个文件的同一个位置都修改了，且内容不同，会产生冲突。

* **解决方法**
  1. `git status`查看冲突文件。
  2. `    git commit`命令后会自动跳转`vim`编译页面，输入`i`进入插入模式，按下`Esc`退出，输入`:wp//强制输入退出`命令。
  3. `git add`告诉**git**系统冲突已解决。
  4. 重新`git commit -m‘冲突解决说明’`。



##### 主要参考资料

###### 版本回滚

1. [CSDN: Git版本回滚的两种方法reset、revert](https://blog.csdn.net/qq_16221009/article/details/125490631)
2. [廖雪峰的git教程：版本回退](https://www.liaoxuefeng.com/wiki/896043488029600/897013573512192)

###### git冲突的解决

1. [CSDN:git冲突原因及解决](http://t.csdn.cn/yT1IC)

2. [CSDN:Git中的vim命令](http://t.csdn.cn/SHBNh)

3. [廖雪峰的git教程：解决冲突](https://www.liaoxuefeng.com/wiki/896043488029600/900004111093344)

